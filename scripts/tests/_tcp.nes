#!/usr/bin/nesla
if (type(expect)=='null') { include("_expect.nes"); }
function testtcp() {
	if (type(http)!='table') {
		print("SKIPPING TCP TESTS\n");
		return;
	}
	print("\tsucking http://nesla.sourceforge.net/nesla/\n");
	ht=http.get(0, "nesla.sourceforge.net", 80, "/nesla/");
	if (type(ht)!='table') {
		print("\t[", ht, "]\n");
	} else {
		X=xml.read(ht.body);
		expect("xml.read(...)", "NullLogic - NESLA", X['HTML'][0]['HEAD'][0]['TITLE'][0]['value']);
		print("\tstring.len(ht.body) = ", string.len(ht.body), "\n");

		print("\tsucking http://nesla.sourceforge.net/nesla/version.php\n");
		ht=http.get(0, "nesla.sourceforge.net", 80, "/nesla/version.php");
		if (type(ht)!='table') {
			print("\t[", ht, "]\n");
		} else {
			X=xml.read(ht.body);
			expect("Latest Version", _version_, X['version'][0]['major'][0]['value']+'.'+X['version'][0]['minor'][0]['value']+'.'+X['version'][0]['point'][0]['value']);
#			print("\tstring.len(ht.body) = ", string.len(ht.body), "\n");
		}

	}
#	print("[[[", ht.head, "]]]\n");
#	print("[[[", ht.body, "]]]\n");
	return;
}
testtcp();
