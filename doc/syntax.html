<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
<TITLE>NullLogic - Welcome</TITLE>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=us-ascii">
<META HTTP-EQUIV="Keywords" CONTENT="nulllogic, nesla, groupware, webmail">
<META HTTP-EQUIV="Description" CONTENT="Nesla is the script language for C programmers.">
<LINK REL="SHORTCUT ICON" HREF="/favicon.ico">
<STYLE TYPE="text/css">
A             { COLOR: #0000FF; TEXT-DECORATION: underline }
A.SMENU       { COLOR: #FFFFFF; TEXT-DECORATION: none; }
A.SMENU:HOVER { COLOR: #399CDE; TEXT-DECORATION: none; }
P { text-align:justify }
</STYLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="/style.css">
<SCRIPT LANGUAGE=JavaScript TYPE="text/javascript">
<!--
function showpage(c,p) {
	var coll=document.all.tags("DIV");
	if (coll==null) return;
	for (i=0;i<coll.length;i++) {
		if (coll[i].id=='c'+c+'m') {
			coll[i].style.display='block';
		} else if (coll[i].id=='c'+c+'p'+p) {
			coll[i].style.display='block';
		} else {
			coll[i].style.display='none';
		}
	}
}
// -->
</SCRIPT>
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#000066" VLINK="#606060" MARGINWIDTH="0" MARGINHEIGHT="0" TOPMARGIN="0" LEFTMARGIN="0" RIGHTMARGIN="0" BOTTOMMARGIN="0">

<BASEFONT FACE="Verdana, Arial, Helvetica, sans-serif" SIZE="2">
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" HEIGHT="100%" WIDTH="100%">
<TR>
	<TD BGCOLOR="#003399" COLSPAN=3 ALIGN="CENTER" VALIGN="TOP" HEIGHT=40 WIDTH="99%" CLASS="welcome" NOWRAP>
	<h2><a href="http://nesla.sourceforge.net/nesla/" CLASS="smenu">NullLogic Embedded Scripting Language - Reference</a></h2>
	</TD>
	<TD WIDTH="10" BGCOLOR="#003399" ALIGN="RIGHT" VALIGN="BOTTOM"><IMG SRC="/images/blue-rounder1.gif" WIDTH="14" HEIGHT="20" BORDER="0" ALT=""></TD>
</TR>
<TR>
	<TD HEIGHT="100%" WIDTH="200" BGCOLOR="#003399" VALIGN=TOP>
		<HR NOSHADE SIZE="0.5" WIDTH="160">
		<H2 CLASS="lefttitle"><FONT COLOR="#399CDE">&nbsp;Menu</FONT></H2>
		<P CLASS="smenu">
		<A CLASS="smenu" HREF="#c1p0"               onClick="showpage('1', '0');               return false;"><NOBR>Introduction</NOBR></A><BR>
<DIV ID=c1m STYLE='display: block'>
</DIV>
		<A CLASS="smenu" HREF="#c2p0"               onClick="showpage('2', '0');               return false;"><NOBR>Functions - core</NOBR></A><BR>
<DIV ID=c2m STYLE='display: block'>
		<A CLASS="smenu" HREF="#c2p_core_eval"      onClick="showpage('2', '_core_eval');      return false;">&nbsp;&nbsp;eval();</A><BR>
		<A CLASS="smenu" HREF="#c2p_core_iname"     onClick="showpage('2', '_core_iname');     return false;">&nbsp;&nbsp;iname();</A><BR>
		<A CLASS="smenu" HREF="#c2p_core_include"   onClick="showpage('2', '_core_include');   return false;">&nbsp;&nbsp;include();</A><BR>
		<A CLASS="smenu" HREF="#c2p_core_ival"      onClick="showpage('2', '_core_ival');      return false;">&nbsp;&nbsp;ival();</A><BR>
		<A CLASS="smenu" HREF="#c2p_core_print"     onClick="showpage('2', '_core_print');     return false;">&nbsp;&nbsp;print();</A><BR>
		<A CLASS="smenu" HREF="#c2p_core_printvar"  onClick="showpage('2', '_core_printvar');  return false;">&nbsp;&nbsp;printvar();</A><BR>
		<A CLASS="smenu" HREF="#c2p_core_runtime"   onClick="showpage('2', '_core_runtime');   return false;">&nbsp;&nbsp;runtime();</A><BR>
		<A CLASS="smenu" HREF="#c2p_core_sizeof"    onClick="showpage('2', '_core_sizeof');    return false;">&nbsp;&nbsp;sizeof();</A><BR>
		<A CLASS="smenu" HREF="#c2p_core_sleep"     onClick="showpage('2', '_core_sleep');     return false;">&nbsp;&nbsp;sleep();</A><BR>
		<A CLASS="smenu" HREF="#c2p_core_system"    onClick="showpage('2', '_core_system');    return false;">&nbsp;&nbsp;system();</A><BR>
		<A CLASS="smenu" HREF="#c2p_core_tonumber"  onClick="showpage('2', '_core_tonumber');  return false;">&nbsp;&nbsp;tonumber();</A><BR>
		<A CLASS="smenu" HREF="#c2p_core_tostring"  onClick="showpage('2', '_core_tostring');  return false;">&nbsp;&nbsp;tostring();</A><BR>
		<A CLASS="smenu" HREF="#c2p_core_typeof"    onClick="showpage('2', '_core_typeof');    return false;">&nbsp;&nbsp;typeof();</A><BR>
		<A CLASS="smenu" HREF="#c2p_core_write"     onClick="showpage('2', '_core_write');     return false;">&nbsp;&nbsp;write();</A><BR>
</DIV>
		<A CLASS="smenu" HREF="#c3p0"               onClick="showpage('3', '0');               return false;"><NOBR>Functions - file</NOBR></A><BR>
<DIV ID=c3m STYLE='display: block'>
		<A CLASS="smenu" HREF="#c3p_file_read"      onClick="showpage('3', '_file_read');      return false;">&nbsp;&nbsp;file.read();</A><BR>
		<A CLASS="smenu" HREF="#c3p_file_stat"      onClick="showpage('3', '_file_stat');      return false;">&nbsp;&nbsp;file.stat();</A><BR>
		<A CLASS="smenu" HREF="#c3p_file_unlink"    onClick="showpage('3', '_file_unlink');    return false;">&nbsp;&nbsp;file.unlink();</A><BR>
		<A CLASS="smenu" HREF="#c3p_file_write"     onClick="showpage('3', '_file_write');     return false;">&nbsp;&nbsp;file.write();</A><BR>
</DIV>
		<A CLASS="smenu" HREF="#c4p0"               onClick="showpage('4', '0');               return false;"><NOBR>Functions - io</NOBR></A><BR>
<DIV ID=c4m STYLE='display: block'>
		<A CLASS="smenu" HREF="#c4p_io_flush"       onClick="showpage('4', '_io_flush');       return false;">&nbsp;&nbsp;io.flush();</A><BR>
		<A CLASS="smenu" HREF="#c4p_io_print"       onClick="showpage('4', '_io_print');       return false;">&nbsp;&nbsp;io.print();</A><BR>
		<A CLASS="smenu" HREF="#c4p_io_write"       onClick="showpage('4', '_io_write');       return false;">&nbsp;&nbsp;io.write();</A><BR>
</DIV>
		<A CLASS="smenu" HREF="#c5p0"               onClick="showpage('5', '0');               return false;"><NOBR>Functions - math</NOBR></A><BR>
<DIV ID=c5m STYLE='display: block'>
		<A CLASS="smenu" HREF="#c5p_math_abs"       onClick="showpage('5', '_math_abs');       return false;">&nbsp;&nbsp;math.abs();</A><BR>
		<A CLASS="smenu" HREF="#c5p_math_acos"      onClick="showpage('5', '_math_acos');      return false;">&nbsp;&nbsp;math.acos();</A><BR>
		<A CLASS="smenu" HREF="#c5p_math_asin"      onClick="showpage('5', '_math_asin');      return false;">&nbsp;&nbsp;math.asin();</A><BR>
		<A CLASS="smenu" HREF="#c5p_math_atan"      onClick="showpage('5', '_math_atan');      return false;">&nbsp;&nbsp;math.atan();</A><BR>
		<A CLASS="smenu" HREF="#c5p_math_ceil"      onClick="showpage('5', '_math_ceil');      return false;">&nbsp;&nbsp;math.ceil();</A><BR>
		<A CLASS="smenu" HREF="#c5p_math_cos"       onClick="showpage('5', '_math_cos');       return false;">&nbsp;&nbsp;math.cos();</A><BR>
		<A CLASS="smenu" HREF="#c5p_math_floor"     onClick="showpage('5', '_math_floor');     return false;">&nbsp;&nbsp;math.floor();</A><BR>
		<A CLASS="smenu" HREF="#c5p_math_rand"      onClick="showpage('5', '_math_rand');      return false;">&nbsp;&nbsp;math.rand();</A><BR>
		<A CLASS="smenu" HREF="#c5p_math_sin"       onClick="showpage('5', '_math_sin');       return false;">&nbsp;&nbsp;math.sin();</A><BR>
		<A CLASS="smenu" HREF="#c5p_math_sqrt"      onClick="showpage('5', '_math_sqrt');      return false;">&nbsp;&nbsp;math.sqrt();</A><BR>
		<A CLASS="smenu" HREF="#c5p_math_tan"       onClick="showpage('5', '_math_tan');       return false;">&nbsp;&nbsp;math.tan();</A><BR>
</DIV>
		<A CLASS="smenu" HREF="#c6p0"               onClick="showpage('6', '0');               return false;"><NOBR>Functions - string</NOBR></A><BR>
<DIV ID=c6m STYLE='display: block'>
		<A CLASS="smenu" HREF="#c6p_string_cat"     onClick="showpage('6', '_string_cat');     return false;">&nbsp;&nbsp;string.cat();</A><BR>
		<A CLASS="smenu" HREF="#c6p_string_cmp"     onClick="showpage('6', '_string_cmp');     return false;">&nbsp;&nbsp;string.cmp();</A><BR>
		<A CLASS="smenu" HREF="#c6p_string_icmp"    onClick="showpage('6', '_string_icmp');    return false;">&nbsp;&nbsp;string.icmp();</A><BR>
		<A CLASS="smenu" HREF="#c6p_string_join"    onClick="showpage('6', '_string_join');    return false;">&nbsp;&nbsp;string.join();</A><BR>
		<A CLASS="smenu" HREF="#c6p_string_ncmp"    onClick="showpage('6', '_string_ncmp');    return false;">&nbsp;&nbsp;string.ncmp();</A><BR>
		<A CLASS="smenu" HREF="#c6p_string_nicmp"   onClick="showpage('6', '_string_nicmp');   return false;">&nbsp;&nbsp;string.nicmp();</A><BR>
		<A CLASS="smenu" HREF="#c6p_string_len"     onClick="showpage('6', '_string_len');     return false;">&nbsp;&nbsp;string.len();</A><BR>
		<A CLASS="smenu" HREF="#c6p_string_split"   onClick="showpage('6', '_string_split');   return false;">&nbsp;&nbsp;string.split();</A><BR>
		<A CLASS="smenu" HREF="#c6p_string_str"     onClick="showpage('6', '_string_str');     return false;">&nbsp;&nbsp;string.str();</A><BR>
		<A CLASS="smenu" HREF="#c6p_string_istr"    onClick="showpage('6', '_string_istr');    return false;">&nbsp;&nbsp;string.istr();</A><BR>
		<A CLASS="smenu" HREF="#c6p_string_sub"     onClick="showpage('6', '_string_sub');     return false;">&nbsp;&nbsp;string.sub();</A><BR>
		<A CLASS="smenu" HREF="#c6p_string_tolower" onClick="showpage('6', '_string_tolower'); return false;">&nbsp;&nbsp;string.tolower();</A><BR>
		<A CLASS="smenu" HREF="#c6p_string_toupper" onClick="showpage('6', '_string_toupper'); return false;">&nbsp;&nbsp;string.toupper();</A><BR>
</DIV>
		<A CLASS="smenu" HREF="#c7p0"               onClick="showpage('7', '0');               return false;"><NOBR>Functions - time</NOBR></A><BR>
<DIV ID=c7m STYLE='display: block'>
		<A CLASS="smenu" HREF="#c7p_time_gmtime"    onClick="showpage('7', '_time_gmtime');    return false;">&nbsp;&nbsp;time.gmtime();</A><BR>
		<A CLASS="smenu" HREF="#c7p_time_localtime" onClick="showpage('7', '_time_localtime'); return false;">&nbsp;&nbsp;time.localtime();</A><BR>
		<A CLASS="smenu" HREF="#c7p_time_now"       onClick="showpage('7', '_time_now');       return false;">&nbsp;&nbsp;time.now();</A><BR>
		<A CLASS="smenu" HREF="#c7p_time_sqldate"   onClick="showpage('7', '_time_sqldate');   return false;">&nbsp;&nbsp;time.sqldate();</A><BR>
		<A CLASS="smenu" HREF="#c7p_time_sqltime"   onClick="showpage('7', '_time_sqltime');   return false;">&nbsp;&nbsp;time.sqltime();</A><BR>
</DIV>
		<A CLASS="smenu" HREF="#c8p0"               onClick="showpage('8', '0');               return false;"><NOBR>libext</NOBR></A><BR>
<DIV ID=c8m STYLE='display: block'>
		<A CLASS="smenu" HREF="#c8p_libext_base64_decode" onClick="showpage('8', '_libext_base64_decode'); return false;">&nbsp;&nbsp;base64.decode();</A><BR>
		<A CLASS="smenu" HREF="#c8p_libext_base64_encode" onClick="showpage('8', '_libext_base64_encode'); return false;">&nbsp;&nbsp;base64.encode();</A><BR>
		<A CLASS="smenu" HREF="#c8p_libext_dirlist"       onClick="showpage('8', '_libext_dirlist');       return false;">&nbsp;&nbsp;dirlist();</A><BR>
		<A CLASS="smenu" HREF="#c8p_libext_rot13"         onClick="showpage('8', '_libext_rot13');         return false;">&nbsp;&nbsp;rot13();</A><BR>
		<A CLASS="smenu" HREF="#c8p_libext_sort_bykey"    onClick="showpage('8', '_libext_sort_bykey');    return false;">&nbsp;&nbsp;sort.bykey();</A><BR>
		<A CLASS="smenu" HREF="#c8p_libext_sort_byname"   onClick="showpage('8', '_libext_sort_byname');   return false;">&nbsp;&nbsp;sort.byname();</A><BR>
		<A CLASS="smenu" HREF="#c8p_libext_xml_read"      onClick="showpage('8', '_libext_xml_read');      return false;">&nbsp;&nbsp;xml.read();</A><BR>
</DIV>
		<A CLASS="smenu" HREF="#c9p0"               onClick="showpage('9', '0');               return false;"><NOBR>libtcp</NOBR></A><BR>
<DIV ID=c9m STYLE='display: block'>
		<A CLASS="smenu" HREF="#c9p_libtcp_http_get"   onClick="showpage('9', '_libtcp_http_get');   return false;">&nbsp;&nbsp;http.get();</A><BR>
		<A CLASS="smenu" HREF="#c9p_libtcp_tcp_accept" onClick="showpage('9', '_libtcp_tcp_accept'); return false;">&nbsp;&nbsp;tcp.accept();</A><BR>
		<A CLASS="smenu" HREF="#c9p_libtcp_tcp_bind"   onClick="showpage('9', '_libtcp_tcp_bind');   return false;">&nbsp;&nbsp;tcp.bind();</A><BR>
		<A CLASS="smenu" HREF="#c9p_libtcp_tcp_close"  onClick="showpage('9', '_libtcp_tcp_close');  return false;">&nbsp;&nbsp;tcp.close();</A><BR>
		<A CLASS="smenu" HREF="#c9p_libtcp_tcp_gets"   onClick="showpage('9', '_libtcp_tcp_gets');   return false;">&nbsp;&nbsp;tcp.gets();</A><BR>
		<A CLASS="smenu" HREF="#c9p_libtcp_tcp_open"   onClick="showpage('9', '_libtcp_tcp_open');   return false;">&nbsp;&nbsp;tcp.open();</A><BR>
		<A CLASS="smenu" HREF="#c9p_libtcp_tcp_read"   onClick="showpage('9', '_libtcp_tcp_read');   return false;">&nbsp;&nbsp;tcp.read();</A><BR>
		<A CLASS="smenu" HREF="#c9p_libtcp_tcp_write"  onClick="showpage('9', '_libtcp_tcp_write');  return false;">&nbsp;&nbsp;tcp.write();</A><BR>
</DIV>
		<A CLASS="smenu" HREF="#c10p0"              onClick="showpage('10', '0');              return false;"><NOBR>C API</NOBR></A><BR>
<DIV ID=c10m STYLE='display: block'>
</DIV>
		</p>
		<HR NOSHADE SIZE="0.5" WIDTH="160">
	</TD>
	<TD HEIGHT="100%" VALIGN=TOP width="100%">
<DIV ID=c1p0 STYLE='display: block'><h1>1 - Introduction</h1>
<p>
I suck at writing documentation, so this will be short and bitter.  For working
samples, check out scripts/tests/*.nes
</p>
<p>
Nesla's earliest lines of code were derived from all the configuration file
parsers I kept writing over and over, and was never happy with.  With the
hassle of writing new functions to deal with different files, and adding
callback functions to deal with subsections, and _then_ taking the parsed
data and making that data accessible to other loaded functions and modules,
not to mention the whole memory management part, and the need to keep track
of not only the name and type of variable, but also the size...  Well, I guess
I'm just lucky I have a sense of humour.
</p>
<p>
So here was a goal: A flexible config parser, a simple and universal data
storage model, a short and simple command set, a zero effort memory management
system that didn't suck, and a C api that wouldn't be painful or difficult to
use in other projects.  Whether or not it became a fully functional scripting
language of its own was entirely incidental.  What I ended up with is the Nesla
core library; the scripting language for C programmers.
</p>
<p>
Syntactically, Nesla probably looks more like javascript than it does any other
language.  Use of the word 'object' may be less than 100% accurate, there are
no properties, methods, events, or classes in the javascript sense, but the C
syntax rules are nearly identical.  Nesla is not an emulation of javascript,
but both language designs do agree that C syntax is good and dollar signs are
ugly.
</p>


<HR>
<P>
<B>OOPS</B>
So here's the deal on 'Object Oriented Programming'.  I don't get it.  I'm not
saying it's bad or that people who do it are deviants.  I'm just not sure what
the working definition of OO is these days.  Nesla's storage system is entirely
object-based, but that doesn't make the language object oriented.  I added a
'this' variable so functions could infer the context in which they were called.
Does this make Nesla an OO language?  Consider the following code:
</P>

<PRE><B>function</B> new_str<FONT COLOR=MAROON><B>(</B></FONT>val<FONT COLOR=MAROON><B>)</B></FONT> <FONT COLOR=MAROON><B>{</B></FONT>
        this <FONT COLOR=MAROON><B>=</B></FONT> <FONT COLOR=MAROON><B>{</B></FONT>
                size  <FONT COLOR=MAROON><B>=</B></FONT> <B>function</B> <FONT COLOR=MAROON><B>(</B></FONT><FONT COLOR=MAROON><B>)</B></FONT> <FONT COLOR=MAROON><B>{</B></FONT> <B>return</B> sizeof<FONT COLOR=MAROON><B>(</B></FONT>this<FONT COLOR=MAROON><B>.</B></FONT>value<FONT COLOR=MAROON><B>)</B></FONT><FONT COLOR=MAROON><B>;</B></FONT> <FONT COLOR=MAROON><B>}</B></FONT><FONT COLOR=MAROON><B>;</B></FONT>
                lower <FONT COLOR=MAROON><B>=</B></FONT> <B>function</B> <FONT COLOR=MAROON><B>(</B></FONT><FONT COLOR=MAROON><B>)</B></FONT> <FONT COLOR=MAROON><B>{</B></FONT> <B>return</B> string<FONT COLOR=MAROON><B>.</B></FONT>tolower<FONT COLOR=MAROON><B>(</B></FONT>this<FONT COLOR=MAROON><B>.</B></FONT>value<FONT COLOR=MAROON><B>)</B></FONT><FONT COLOR=MAROON><B>;</B></FONT> <FONT COLOR=MAROON><B>}</B></FONT><FONT COLOR=MAROON><B>;</B></FONT>
                upper <FONT COLOR=MAROON><B>=</B></FONT> <B>function</B> <FONT COLOR=MAROON><B>(</B></FONT><FONT COLOR=MAROON><B>)</B></FONT> <FONT COLOR=MAROON><B>{</B></FONT> <B>return</B> string<FONT COLOR=MAROON><B>.</B></FONT>toupper<FONT COLOR=MAROON><B>(</B></FONT>this<FONT COLOR=MAROON><B>.</B></FONT>value<FONT COLOR=MAROON><B>)</B></FONT><FONT COLOR=MAROON><B>;</B></FONT> <FONT COLOR=MAROON><B>}</B></FONT><FONT COLOR=MAROON><B>;</B></FONT>
                value <FONT COLOR=MAROON><B>=</B></FONT> val<FONT COLOR=MAROON><B>;</B></FONT>
        <FONT COLOR=MAROON><B>}</B></FONT><FONT COLOR=MAROON><B>;</B></FONT>
        <B>return</B> this<FONT COLOR=MAROON><B>;</B></FONT>
<FONT COLOR=MAROON><B>}</B></FONT>
x<FONT COLOR=MAROON><B>=</B></FONT>new_str<FONT COLOR=MAROON><B>(</B></FONT><FONT COLOR=BLUE>"AbC"</FONT><FONT COLOR=MAROON><B>)</B></FONT><FONT COLOR=MAROON><B>;</B></FONT>
print<FONT COLOR=MAROON><B>(</B></FONT><FONT COLOR=BLUE>"["</FONT><FONT COLOR=MAROON><B>+</B></FONT>x<FONT COLOR=MAROON><B>.</B></FONT>size<FONT COLOR=MAROON><B>(</B></FONT><FONT COLOR=MAROON><B>)</B></FONT><FONT COLOR=MAROON><B>+</B></FONT><FONT COLOR=BLUE>"]\n"</FONT><FONT COLOR=MAROON><B>)</B></FONT><FONT COLOR=MAROON><B>;</B></FONT>  <FONT COLOR=GREEN><I>// will print 3</I></FONT>
x<FONT COLOR=MAROON><B>.</B></FONT>value<FONT COLOR=MAROON><B>=</B></FONT><FONT COLOR=BLUE>"aBcDeF"</FONT><FONT COLOR=MAROON><B>;</B></FONT>
print<FONT COLOR=MAROON><B>(</B></FONT><FONT COLOR=BLUE>"["</FONT><FONT COLOR=MAROON><B>+</B></FONT>x<FONT COLOR=MAROON><B>.</B></FONT>size<FONT COLOR=MAROON><B>(</B></FONT><FONT COLOR=MAROON><B>)</B></FONT><FONT COLOR=MAROON><B>+</B></FONT><FONT COLOR=BLUE>"]\n"</FONT><FONT COLOR=MAROON><B>)</B></FONT><FONT COLOR=MAROON><B>;</B></FONT>  <FONT COLOR=GREEN><I>// will print 6</I></FONT>
print<FONT COLOR=MAROON><B>(</B></FONT><FONT COLOR=BLUE>"["</FONT><FONT COLOR=MAROON><B>+</B></FONT>x<FONT COLOR=MAROON><B>.</B></FONT>lower<FONT COLOR=MAROON><B>(</B></FONT><FONT COLOR=MAROON><B>)</B></FONT><FONT COLOR=MAROON><B>+</B></FONT><FONT COLOR=BLUE>"]\n"</FONT><FONT COLOR=MAROON><B>)</B></FONT><FONT COLOR=MAROON><B>;</B></FONT> <FONT COLOR=GREEN><I>// will print abcdef</I></FONT>
print<FONT COLOR=MAROON><B>(</B></FONT><FONT COLOR=BLUE>"["</FONT><FONT COLOR=MAROON><B>+</B></FONT>x<FONT COLOR=MAROON><B>.</B></FONT>upper<FONT COLOR=MAROON><B>(</B></FONT><FONT COLOR=MAROON><B>)</B></FONT><FONT COLOR=MAROON><B>+</B></FONT><FONT COLOR=BLUE>"]\n"</FONT><FONT COLOR=MAROON><B>)</B></FONT><FONT COLOR=MAROON><B>;</B></FONT> <FONT COLOR=GREEN><I>// will print ABCDEF</I></FONT></PRE>

<P>
Is that technically an example of OO?  True, most OO code has nicer looking
constructors and classes and stuff I don't get, but this is working Nesla code.
</P>
</DIV><DIV ID=c2p0 STYLE='display: block'><h1>2 - The Language</h1>

<h2>Keywords</h2>

<p>
break continue return function global local var if else for do while exit
</p>
<p>
Working code looks a little like the following sample.
</p>
<PRE><B>function</B> demo<FONT COLOR=MAROON><B>(</B></FONT>arg1<FONT COLOR=MAROON><B>)</B></FONT> <FONT COLOR=MAROON><B>{</B></FONT>
        <B>global</B> x<FONT COLOR=MAROON><B>=</B></FONT><FONT COLOR=NAVY>1</FONT><FONT COLOR=MAROON><B>;</B></FONT>
        <FONT COLOR=GREEN><I># you don't actually need local or var, but it makes the code clearer</I></FONT>
        <B>local</B> y<FONT COLOR=MAROON><B>=</B></FONT><FONT COLOR=NAVY>2</FONT><FONT COLOR=MAROON><B>;</B></FONT>
        <B>var</B> z<FONT COLOR=MAROON><B>=</B></FONT><FONT COLOR=NAVY>3</FONT><FONT COLOR=MAROON><B>;</B></FONT>

        <B>for</B> <FONT COLOR=MAROON><B>(</B></FONT>i<FONT COLOR=MAROON><B>=</B></FONT><FONT COLOR=NAVY>0</FONT><FONT COLOR=MAROON><B>;</B></FONT>i<FONT COLOR=MAROON><B>&lt;</B></FONT><FONT COLOR=NAVY>10</FONT><FONT COLOR=MAROON><B>;</B></FONT>i<FONT COLOR=MAROON><B>++</B></FONT><FONT COLOR=MAROON><B>)</B></FONT> <FONT COLOR=MAROON><B>{</B></FONT>
                <B>if</B> <FONT COLOR=MAROON><B>(</B></FONT>i<FONT COLOR=MAROON><B>&lt;</B></FONT><FONT COLOR=NAVY>5</FONT><FONT COLOR=MAROON><B>)</B></FONT> <FONT COLOR=MAROON><B>{</B></FONT>
                        print<FONT COLOR=MAROON><B>(</B></FONT><FONT COLOR=BLUE>"less than half "</FONT><FONT COLOR=MAROON><B>,</B></FONT> i<FONT COLOR=MAROON><B>,</B></FONT> <FONT COLOR=BLUE>"\n"</FONT><FONT COLOR=MAROON><B>)</B></FONT><FONT COLOR=MAROON><B>;</B></FONT>
                <FONT COLOR=MAROON><B>}</B></FONT> <B>else</B> <B>if</B> <FONT COLOR=MAROON><B>(</B></FONT>i<FONT COLOR=MAROON><B>==</B></FONT><FONT COLOR=NAVY>5</FONT><FONT COLOR=MAROON><B>)</B></FONT> <FONT COLOR=MAROON><B>{</B></FONT>
                        print<FONT COLOR=MAROON><B>(</B></FONT><FONT COLOR=BLUE>"half\n"</FONT><FONT COLOR=MAROON><B>)</B></FONT><FONT COLOR=MAROON><B>;</B></FONT>
                <FONT COLOR=MAROON><B>}</B></FONT> <B>else</B> <FONT COLOR=MAROON><B>{</B></FONT>
                        print<FONT COLOR=MAROON><B>(</B></FONT><FONT COLOR=BLUE>"more than half "</FONT><FONT COLOR=MAROON><B>,</B></FONT> i<FONT COLOR=MAROON><B>,</B></FONT> <FONT COLOR=BLUE>"\n"</FONT><FONT COLOR=MAROON><B>)</B></FONT><FONT COLOR=MAROON><B>;</B></FONT>
                <FONT COLOR=MAROON><B>}</B></FONT>
                <B>if</B> <FONT COLOR=MAROON><B>(</B></FONT>i<FONT COLOR=MAROON><B>==</B></FONT>arg1<FONT COLOR=MAROON><B>)</B></FONT> <B>break</B><FONT COLOR=MAROON><B>;</B></FONT>
        <FONT COLOR=MAROON><B>}</B></FONT>
        <B>return</B><FONT COLOR=MAROON><B>;</B></FONT>
<FONT COLOR=MAROON><B>}</B></FONT>
demo<FONT COLOR=MAROON><B>(</B></FONT><FONT COLOR=NAVY>8</FONT><FONT COLOR=MAROON><B>)</B></FONT><FONT COLOR=MAROON><B>;</B></FONT>
</PRE>
<p>
break (accepts an optional unbracketed number arg to define the number of levels to break)<br>
still need to add switch and goto..
</p>

<h2>Operators</h2>

<p>
= + ++ += - -- -= * *= / /= == != <= >= < > % & | ^ && || !
</p>
<p>
Strings can also be handled using the slightly shorter list of ops: = + += == != <= >= < >
</p>
<p>
The statement <B>var x="a"+"b";</B> will set x to "ab".
</p>
<p>
Tables have considerably less ops: = {}
<pre>
<B>function</B> subf() { <B>return</B> 69; }
<B>var</B> pi = <B>math.asin</B>(1)*2;
<B>var</B> table = {
	{ a1="x", b = pi, [12]=41, [1]=42, 43, 'blah', subf() },
	{ "x", 'y', x = 41, 42, 43, 'blah', [5]=12, heh=";-)" }
};
</pre>
</p>
<p>
setting a var's value to null will completely free the value and effectively make the var non-existant
</p>
</DIV><DIV ID=c2p_core_eval      STYLE='display: block'><!-- CONTENTS_START -->
<A NAME="nesla_eval"></A>
<H2>eval<BR><HR></H2>

<H4>Description</H4>
<BLOCKQUOTE><P>
<P>Evaluates a supplied expression.
</BLOCKQUOTE>
<!-- CONTENTS_END -->
</DIV><DIV ID=c2p_core_iname     STYLE='display: block'><!-- CONTENTS_START -->
<A NAME="nesla_iname"></A>
<H2>iname<BR><HR></H2>

<H4>Description</H4>
<BLOCKQUOTE><P>
<P>Returns the name of a table entry at a given index.
</BLOCKQUOTE>
<!-- CONTENTS_END -->
</DIV><DIV ID=c2p_core_include   STYLE='display: block'><!-- CONTENTS_START -->
<a name="nesla_include"></a>
<H2>include<BR><HR></H2>

<H4>Description</H4>
<BLOCKQUOTE><P>
<P>Include (and interpret) the code in the specified file.
</BLOCKQUOTE>

<H4>Syntax</H4>
<BLOCKQUOTE><P><I>number</I> <B>=</B> <B>include(</B><I>filename</I><B>)<BR></B></BLOCKQUOTE><P>
<BLOCKQUOTE>
<TABLE BGCOLOR="#E0E0E0" WIDTH=87% CELLPADDING=5 CELLSPACING=0>
<TR><TD><B>Parameter</B></TD><TD><B>Description</B></TD></TR>
<TR><TD><I>filename</I> </TD><TD>String containing the name of the file to be included.</TD></TR>
</TABLE></BLOCKQUOTE>

<H4>Return Value</H4>
<BLOCKQUOTE><P>
<P>Returns zero if the file has been successfully included.  Any non-zero return code indicates an error.
</BLOCKQUOTE><P>

<H4>Remarks</H4>
<BLOCKQUOTE><P>
<P>Return codes indicating failure are almost always caused by a nonexistent
or unreadable script file, not errors in the script itself.
</BLOCKQUOTE><P>

<H4>Example</H4>
<BLOCKQUOTE><P>
The following example demonstrates how to load a script and verify its success.
<P>
<TABLE BORDER="0" BGCOLOR="#E0E0E0" CELLPADDING="5"><TR><TD>
<CODE>
	rval=<B>include</B>("./somefile.nes");<BR>
	<B>if</B> (rval!=0) <B>print</B>("error loading ./somefile.nes\n");
</CODE></TD></TR></TABLE>
</BLOCKQUOTE><P>
<!-- CONTENTS_END -->
</DIV><DIV ID=c2p_core_ival      STYLE='display: block'><!-- CONTENTS_START -->
<A NAME="nesla_ival"></A>
<H2>ival<BR><HR></H2>

<H4>Description</H4>
<BLOCKQUOTE><P>
<P>Returns a pointer to the value of a table entry at a given index.
</BLOCKQUOTE>
<!-- CONTENTS_END -->
</DIV><DIV ID=c2p_core_print     STYLE='display: block'><!-- CONTENTS_START -->
<a name="nesla_print"></a>
<H2>print<BR><HR></H2>

<H4>Description</H4>
<BLOCKQUOTE><P>
<P>Print the complete list of arguments to the standard output.
</BLOCKQUOTE>

<H4>Syntax</H4>
<BLOCKQUOTE><P><I>number</I> <B>=</B> <B>print(</B><I>...</I><B>)<BR></B></BLOCKQUOTE><P>
<BLOCKQUOTE>
<TABLE BGCOLOR="#E0E0E0" WIDTH=87% CELLPADDING=5 CELLSPACING=0>
<TR><TD><B>Parameter</B></TD><TD><B>Description</B></TD></TR>
<TR><TD><I>...</I> </TD><TD>List of objects to be printed.</TD></TR>
</TABLE></BLOCKQUOTE>

<H4>Return Value</H4>
<BLOCKQUOTE><P>
<P>Returns the number of characters printed.
</BLOCKQUOTE><P>

<H4>Remarks</H4>
<BLOCKQUOTE><P>
<P>Any argument that is not a string will be formatted automatically.  Boolean
values will be 'true' or 'false' and numbers will have up to 6 digits past the
decimal.  Most string functions may be binary safe, but this function _will_
terminate its output at the first \0 character.
</BLOCKQUOTE><P>

<H4>Examples</H4>
<BLOCKQUOTE><P>
The following example demonstrates how to print multiple objects.
<P>
<TABLE BORDER="0" BGCOLOR="#E0E0E0" CELLPADDING="5"><TR><TD>
<CODE>
	<B>print</B>("Hello", "world.\n");<BR>
</CODE></TD></TR></TABLE>
</BLOCKQUOTE><P>
<BLOCKQUOTE><P>
The following example gives the same output as above, but note that using + to
concatenate the strings means that print only receives one argument.
<P>
<TABLE BORDER="0" BGCOLOR="#E0E0E0" CELLPADDING="5"><TR><TD>
<CODE>
	<B>print</B>("Hello"+"world.\n");<BR>
</CODE></TD></TR></TABLE>
</BLOCKQUOTE><P>

<H4>See Also</H4>
<BLOCKQUOTE><P>
<B><A HREF="#c4p_io_print"          onClick="showpage('4', '_io_print');         return false;">io.print()</A></B>
</BLOCKQUOTE><P>
<!-- CONTENTS_END -->
</DIV><DIV ID=c2p_core_printvar  STYLE='display: block'><!-- CONTENTS_START -->
<a name="nesla_printvar"></a>
<H2>printvar<BR><HR></H2>

<H4>Description</H4>
<BLOCKQUOTE><P>
<P>Print the provided var in a format appropriate for use in a nesla script. This will recursively print entire tables.
</BLOCKQUOTE>

<H4>Syntax</H4>
<BLOCKQUOTE><P><B>printvar(</B><I>object var</I><B>)<BR></B></BLOCKQUOTE><P>
<BLOCKQUOTE>
<TABLE BGCOLOR="#E0E0E0" WIDTH=87% CELLPADDING=5 CELLSPACING=0>
<TR><TD><B>Parameter</B></TD><TD><B>Description</B></TD></TR>
<TR><TD><I>var</I> </TD><TD>Object to be printed.  Can be any object type, including table.</TD></TR>
</TABLE></BLOCKQUOTE>

<H4>Return Value</H4>
<BLOCKQUOTE><P>
<P>Returns zero.
</BLOCKQUOTE><P>

<H4>Remarks</H4>
<BLOCKQUOTE><P>
<P>Any argument that is not a string will be formatted automatically.  Boolean
values will be 'true' or 'false' and numbers will have up to 6 digits past the
decimal.  Most string functions may be binary safe, but this function _will_
terminate its output at the first \0 character.
</BLOCKQUOTE><P>

<BLOCKQUOTE><P>
<P>The example "var x={}; x.y=x; <B>printvar</B>(x);" is valid code.
It also recurses infinitely.  Be careful, or you may be cursing infinitely yourself.
</BLOCKQUOTE><P>

<H4>Examples</H4>
<BLOCKQUOTE><P>
The following examples demonstrate the difference between print and printvar.
<P>
<TABLE BORDER="0" BGCOLOR="#E0E0E0" CELLPADDING="5"><TR><TD>
<CODE>
	<B>var x</B>="this \"is a\" test\n";<BR>
	<B>print</B>(x);<BR>
	<BR>will display<BR><BR>this "is a" test
</CODE></TD></TR></TABLE>
</BLOCKQUOTE><P>
<BLOCKQUOTE><P>
<P>
<TABLE BORDER="0" BGCOLOR="#E0E0E0" CELLPADDING="5"><TR><TD>
<CODE>
	<B>var x</B>="this \"is a\" test\n";<BR>
	<B>printvar</B>(x);<BR>
	<BR>will display<BR><BR>"this \"is a\" test\n"
</CODE></TD></TR></TABLE>
</BLOCKQUOTE><P>
<BLOCKQUOTE><P>
<P>
<TABLE BORDER="0" BGCOLOR="#E0E0E0" CELLPADDING="5"><TR><TD>
<CODE>
	<B>var x</B>={ { key='c' }, { key='a' }, { key='b' } };<BR>
	<B>printvar</B>(x);<BR>
	<BR>will display<BR><BR>
<pre>{
        [0] = {
                key = "c"
        },
        [1] = {
                key = "a"
        },
        [2] = {
                key = "b"
        }
}</pre>
</CODE></TD></TR></TABLE>
</BLOCKQUOTE><P>
<!-- CONTENTS_END -->
</DIV><DIV ID=c2p_core_runtime   STYLE='display: block'><!-- CONTENTS_START -->
<a name="nesla_runtime"></a>
<H2>runtime<BR><HR></H2>

<H4>Description</H4>
<BLOCKQUOTE><P>
<P>Returns the elapsed time the parser has been running.
</BLOCKQUOTE>

<H4>Syntax</H4>
<BLOCKQUOTE><P><I>number</I> <B>=</B> <B>runtime(</B><B>)<BR></B></BLOCKQUOTE><P>

<H4>Return Value</H4>
<BLOCKQUOTE><P>
<P>Returns the time in seconds (with microsecond precision) the parser has been running.
</BLOCKQUOTE><P>
<!-- CONTENTS_END -->
</DIV><DIV ID=c2p_core_sizeof    STYLE='display: block'><!-- CONTENTS_START -->
<a name="nesla_sizeof"></a>
<H2>sizeof<BR><HR></H2>

<H4>Description</H4>
<BLOCKQUOTE><P>
<P>Returns the size of the object.
</BLOCKQUOTE>

<H4>Syntax</H4>
<BLOCKQUOTE><P><I>number</I> <B>=</B> <B>sizeof(</B><I>object</I><B>)<BR></B></BLOCKQUOTE><P>
<BLOCKQUOTE>
<TABLE BGCOLOR="#E0E0E0" WIDTH=87% CELLPADDING=5 CELLSPACING=0>
<TR><TD><B>Parameter</B></TD><TD><B>Description</B></TD></TR>
<TR><TD><I>object</I> </TD><TD>Object to be sized.  The return value's meaning will vary depending on this object's type.</TD></TR>
</TABLE></BLOCKQUOTE>

<H4>Return Value</H4>
<BLOCKQUOTE><P>
<P>Returns the size of the object.  For strings, this is the string length;
for tables, the number of non-null objects in the table.  Null values
are zero size.
</BLOCKQUOTE><P>
<!-- CONTENTS_END -->
</DIV><DIV ID=c2p_core_sleep     STYLE='display: block'><!-- CONTENTS_START -->
<a name="nesla_sleep"></a>
<H2>sleep<BR><HR></H2>

<H4>Description</H4>
<BLOCKQUOTE><P>
<P>Sleep for a specified number of seconds.
</BLOCKQUOTE>

<H4>Syntax</H4>
<BLOCKQUOTE><P><B>sleep(</B><I>number seconds</I><B>)<BR></B></BLOCKQUOTE><P>
<BLOCKQUOTE>
<TABLE BGCOLOR="#E0E0E0" WIDTH=87% CELLPADDING=5 CELLSPACING=0>
<TR><TD><B>Parameter</B></TD><TD><B>Description</B></TD></TR>
<TR><TD><I>seconds</I> </TD><TD>Number of seconds the script should pause execution.</TD></TR>
</TABLE></BLOCKQUOTE>

<H4>Return Value</H4>
<BLOCKQUOTE><P>
<P>Returns zero.
</BLOCKQUOTE><P>
<!-- CONTENTS_END -->
</DIV><DIV ID=c2p_core_system    STYLE='display: block'><!-- CONTENTS_START -->
<a name="nesla_system"></a>
<H2>system<BR><HR></H2>

<H4>Description</H4>
<BLOCKQUOTE><P>
<P>Performs an operating system call and returns the resulting errorcode.
</BLOCKQUOTE>

<H4>Syntax</H4>
<BLOCKQUOTE><P><I>number</I> <B>=</B> <B>system(</B><I>string command</I><B>)<BR></B></BLOCKQUOTE><P>
<BLOCKQUOTE>
<TABLE BGCOLOR="#E0E0E0" WIDTH=87% CELLPADDING=5 CELLSPACING=0>
<TR><TD><B>Parameter</B></TD><TD><B>Description</B></TD></TR>
<TR><TD><I>command</I> </TD><TD>Operating system command to be executed.</TD></TR>
</TABLE></BLOCKQUOTE>

<H4>Return Value</H4>
<BLOCKQUOTE><P>
<P>Returns the errorcode after execution of <I>command</I>.
</BLOCKQUOTE><P>

<H4>Remarks</H4>
<BLOCKQUOTE><P>
<P>This function does not include or easily allow any sophisticated methods
such as piping, signal handling, or interactivity.
</BLOCKQUOTE><P>

<H4>Examples</H4>
<BLOCKQUOTE><P>
The following example demonstrates a way to list a directory and then read the results.
<P>
<TABLE BORDER="0" BGCOLOR="#E0E0E0" CELLPADDING="5"><TR><TD>
<CODE>
	<B>system</B>("ls"+" -l"+" > x.txt");<BR>
	x=<B>file.read</B>("x.txt");<BR>
	<B>print</B>(x);<BR>
	<B>file.unlink</B>("x.txt");<BR>
</CODE></TD></TR></TABLE>
</BLOCKQUOTE><P>
<!-- CONTENTS_END -->
</DIV><DIV ID=c2p_core_tonumber  STYLE='display: block'><!-- CONTENTS_START -->
<a name="nesla_tonumber"></a>
<H2>tonumber<BR><HR></H2>

<H4>Description</H4>
<BLOCKQUOTE><P>
<P>Returns a number value equivalent of the source.
</BLOCKQUOTE>

<H4>Syntax</H4>
<BLOCKQUOTE><P><I>number</I> <B>=</B> <B>tonumber(</B><I>object</I><B>)<BR></B></BLOCKQUOTE><P>
<BLOCKQUOTE>
<TABLE BGCOLOR="#E0E0E0" WIDTH=87% CELLPADDING=5 CELLSPACING=0>
<TR><TD><B>Parameter</B></TD><TD><B>Description</B></TD></TR>
<TR><TD><I>object</I> </TD><TD>Object to be converted to a numeric value.</TD></TR>
</TABLE></BLOCKQUOTE>

<H4>Return Value</H4>
<BLOCKQUOTE><P>
<P>Returns a numeric approximation of the object parameter.  Objects such as tables
and null will return zero since no other numeric value can be meaningfully representative.
</BLOCKQUOTE><P>
<!-- CONTENTS_END -->
</DIV><DIV ID=c2p_core_tostring  STYLE='display: block'><!-- CONTENTS_START -->
<a name="nesla_tostring"></a>
<H2>tostring<BR><HR></H2>

<H4>Description</H4>
<BLOCKQUOTE><P>
<P>Returns a string value equivalent of the source.
</BLOCKQUOTE>

<H4>Syntax</H4>
<BLOCKQUOTE><P><I>string</I> <B>=</B> <B>tostring(</B><I>object[, number]</I><B>)<BR></B></BLOCKQUOTE><P>
<BLOCKQUOTE>
<TABLE BGCOLOR="#E0E0E0" WIDTH=87% CELLPADDING=5 CELLSPACING=0>
<TR><TD><B>Parameter</B></TD><TD><B>Description</B></TD></TR>
<TR><TD><I>object</I> </TD><TD>Object to be converted to a numeric value.</TD></TR>
<TR><TD><I>number</I> </TD><TD>Precision to use for a numeric <I>object</I>.</TD></TR>
</TABLE></BLOCKQUOTE>

<H4>Return Value</H4>
<BLOCKQUOTE><P>
<P>Returns a string value equivalent of the source.  If both arguments are
numbers, the second allows the setting of a decimal precision.
</BLOCKQUOTE><P>
<!-- CONTENTS_END -->
</DIV><DIV ID=c2p_core_typeof    STYLE='display: block'><!-- CONTENTS_START -->
<a name="nesla_typeof"></a>
<H2>typeof<BR><HR></H2>

<H4>Description</H4>
<BLOCKQUOTE><P>
<P>Returns the name of the type of object.
</BLOCKQUOTE>

<H4>Syntax</H4>
<BLOCKQUOTE><P><I>string</I> <B>=</B> <B>typeof(</B><I>object</I><B>)<BR></B></BLOCKQUOTE><P>
<BLOCKQUOTE>
<TABLE BGCOLOR="#E0E0E0" WIDTH=87% CELLPADDING=5 CELLSPACING=0>
<TR><TD><B>Parameter</B></TD><TD><B>Description</B></TD></TR>
<TR><TD><I>object</I> </TD><TD>Object to be identified by type.</TD></TR>
</TABLE></BLOCKQUOTE>

<H4>Return Value</H4>
<BLOCKQUOTE><P>
<P>Returns the name of the object type.  Possible types include boolean, number, string, table, function and null.
</BLOCKQUOTE><P>
<!-- CONTENTS_END -->
</DIV><DIV ID=c2p_core_write     STYLE='display: block'><!-- CONTENTS_START -->
<a name="nesla_write"></a>
<H2>write<BR><HR></H2>

<H4>Description</H4>
<BLOCKQUOTE><P>
<P>Writes the entire object as a string and returns the result code.
This function is binary safe.
</BLOCKQUOTE>

<H4>Syntax</H4>
<BLOCKQUOTE><P><I>number</I> <B>=</B> <B>write(</B><I>object</I><B>)<BR></B></BLOCKQUOTE><P>
<BLOCKQUOTE>
<TABLE BGCOLOR="#E0E0E0" WIDTH=87% CELLPADDING=5 CELLSPACING=0>
<TR><TD><B>Parameter</B></TD><TD><B>Description</B></TD></TR>
<TR><TD><I>object</I> </TD><TD>Object to be written to standard output.</TD></TR>
</TABLE></BLOCKQUOTE>

<H4>Return Value</H4>
<BLOCKQUOTE><P>
<P>Returns the number of bytes written.
</BLOCKQUOTE><P>

<H4>See Also</H4>
<BLOCKQUOTE><P>
<B><A HREF="#c4p_io_write"          onClick="showpage('4', '_io_write');         return false;">io.write()</A></B>
</BLOCKQUOTE><P>
<!-- CONTENTS_END -->
</DIV><DIV ID=c3p0 STYLE='display: block'><h1>3 - file.*()</h1>
</DIV><DIV ID=c3p_file_read      STYLE='display: block'><hr><h3><a name="nesla_file_read"><code>(string) file.read(string filename);</code></a></h3>
<p>
Reads the entire file into a string and returns that string.
This function is binary safe, but use of some string functions to manipulate this string may mangle the data.
</p>
</DIV><DIV ID=c3p_file_stat      STYLE='display: block'><hr><h3><a name="nesla_file_stat"><code>(table) file.stat(string filename);</code></a></h3>
<p>
Stats filename and returns a table with stats.
</p>
</DIV><DIV ID=c3p_file_unlink    STYLE='display: block'><hr><h3><a name="nesla_file_unlink"><code>(number) file.unlink(string filename);</code></a></h3>
<p>
Unlink filename and return zero if successful.
</p>
</DIV><DIV ID=c3p_file_write     STYLE='display: block'><hr><h3><a name="nesla_file_write"><code>(number) file.write(string filename[, object]);</code></a></h3>
<p>
Writes the entire object as a string and returns the result code.
This function is binary safe.
</p>
</DIV><DIV ID=c4p0 STYLE='display: block'><h1>4 - io.*()</h1>
</DIV><DIV ID=c4p_io_flush       STYLE='display: block'><!-- CONTENTS_START -->
<a name="nesla_io_flush"></a>
<H2>io.flush<BR><HR></H2>

<H4>Description</H4>
<BLOCKQUOTE><P>
<P>Flushes the output buffer.
</BLOCKQUOTE>

<H4>Syntax</H4>
<BLOCKQUOTE><P><I>number</I> <B>=</B> <B>io.flush(</B><B>)<BR></B></BLOCKQUOTE><P>

<H4>Return Value</H4>
<BLOCKQUOTE><P>
<P>Returns zero.
</BLOCKQUOTE><P>
<!-- CONTENTS_END -->
</DIV><DIV ID=c4p_io_print       STYLE='display: block'><!-- CONTENTS_START -->
<a name="nesla_io_print"></a>
<H2>io.print<BR><HR></H2>

<H4>Description</H4>
<BLOCKQUOTE><P>
<P>Print the complete list of arguments to the standard output.
</BLOCKQUOTE>

<H4>Syntax</H4>
<BLOCKQUOTE><P><I>number</I> <B>=</B> <B>io.print(</B><I>...</I><B>)<BR></B></BLOCKQUOTE><P>
<BLOCKQUOTE>
<TABLE BGCOLOR="#E0E0E0" WIDTH=87% CELLPADDING=5 CELLSPACING=0>
<TR><TD><B>Parameter</B></TD><TD><B>Description</B></TD></TR>
<TR><TD><I>...</I> </TD><TD>List of objects to be printed.</TD></TR>
</TABLE></BLOCKQUOTE>

<H4>Return Value</H4>
<BLOCKQUOTE><P>
<P>Returns the number of characters printed.
</BLOCKQUOTE><P>

<H4>Remarks</H4>
<BLOCKQUOTE><P>
<P>Any argument that is not a string will be formatted automatically.  Boolean
values will be 'true' or 'false' and numbers will have up to 6 digits past the
decimal.  Most string functions may be binary safe, but this function _will_
terminate its output at the first \0 character.
</BLOCKQUOTE><P>

<H4>Examples</H4>
<BLOCKQUOTE><P>
The following example demonstrates how to print multiple objects.
<P>
<TABLE BORDER="0" BGCOLOR="#E0E0E0" CELLPADDING="5"><TR><TD>
<CODE>
	<B>io.print</B>("Hello", "world.\n");<BR>
</CODE></TD></TR></TABLE>
</BLOCKQUOTE><P>
<BLOCKQUOTE><P>
The following example gives the same output as above, but note that using + to
concatenate the strings means that print only receives one argument.
<P>
<TABLE BORDER="0" BGCOLOR="#E0E0E0" CELLPADDING="5"><TR><TD>
<CODE>
	<B>io.print</B>("Hello"+"world.\n");<BR>
</CODE></TD></TR></TABLE>
</BLOCKQUOTE><P>

<H4>See Also</H4>
<BLOCKQUOTE><P>
<B><A HREF="#c2p_core_print"          onClick="showpage('2', '_core_print');         return false;">print()</A></B>
</BLOCKQUOTE><P>
<!-- CONTENTS_END -->
</DIV><DIV ID=c4p_io_write       STYLE='display: block'><!-- CONTENTS_START -->
<a name="nesla_io_write"></a>
<H2>io.write<BR><HR></H2>

<H4>Description</H4>
<BLOCKQUOTE><P>
<P>Writes the entire object as a string and returns the result code.
This function is binary safe.
</BLOCKQUOTE>

<H4>Syntax</H4>
<BLOCKQUOTE><P><I>number</I> <B>=</B> <B>io.write(</B><I>object</I><B>)<BR></B></BLOCKQUOTE><P>
<BLOCKQUOTE>
<TABLE BGCOLOR="#E0E0E0" WIDTH=87% CELLPADDING=5 CELLSPACING=0>
<TR><TD><B>Parameter</B></TD><TD><B>Description</B></TD></TR>
<TR><TD><I>object</I> </TD><TD>Object to be written to standard output.</TD></TR>
</TABLE></BLOCKQUOTE>

<H4>Return Value</H4>
<BLOCKQUOTE><P>
<P>Returns the number of bytes written.
</BLOCKQUOTE><P>

<H4>See Also</H4>
<BLOCKQUOTE><P>
<B><A HREF="#c2p_core_write"          onClick="showpage('2', '_core_write');         return false;">write()</A></B>
</BLOCKQUOTE><P>
<!-- CONTENTS_END -->
</DIV><DIV ID=c5p0 STYLE='display: block'><h1>5 - math.*()</h1>
</DIV><DIV ID=c5p_math_abs       STYLE='display: block'><B>/ * math functions * /</B>
<hr><h3><a name="nesla_math_abs"><code>(number) math.abs(number n);</code></a></h3>
<p>
</DIV><DIV ID=c5p_math_acos      STYLE='display: block'><hr><h3><a name="nesla_math_acos"><code>(number) math.acos(number n);</code></a></h3>
<p>
</DIV><DIV ID=c5p_math_asin      STYLE='display: block'><hr><h3><a name="nesla_math_asin"><code>(number) math.asin(number n);</code></a></h3>
<p>
</DIV><DIV ID=c5p_math_atan      STYLE='display: block'><hr><h3><a name="nesla_math_atan"><code>(number) math.atan(number n);</code></a></h3>
<p>
</DIV><DIV ID=c5p_math_ceil      STYLE='display: block'><hr><h3><a name="nesla_math_ceil"><code>(number) math.ceil(number n);</code></a></h3>
<p>
</DIV><DIV ID=c5p_math_cos       STYLE='display: block'><hr><h3><a name="nesla_math_cos"><code>(number) math.cos(number n);</code></a></h3>
<p>
</DIV><DIV ID=c5p_math_floor     STYLE='display: block'><hr><h3><a name="nesla_math_floor"><code>(number) math.floor(number n);</code></a></h3>
<p>
</DIV><DIV ID=c5p_math_rand      STYLE='display: block'><hr><h3><a name="nesla_math_rand"><code>(number) math.rand([number range]);</code></a></h3>
<p>
</DIV><DIV ID=c5p_math_sin       STYLE='display: block'><hr><h3><a name="nesla_math_sin"><code>(number) math.sin(number n);</code></a></h3>
<p>
</DIV><DIV ID=c5p_math_sqrt      STYLE='display: block'><hr><h3><a name="nesla_math_sqrt"><code>(number) math.sqrt(number n);</code></a></h3>
<p>
</DIV><DIV ID=c5p_math_tan       STYLE='display: block'><hr><h3><a name="nesla_math_tan"><code>(number) math.tan(number n);</code></a></h3>
<p>
</DIV><DIV ID=c6p0 STYLE='display: block'><h1>6 - string.*()</h1>
</DIV><DIV ID=c6p_string_cat     STYLE='display: block'><hr><h3><a name="nesla_string_cat"><code>(string) string.cat(string str1, string str2);</code></a></h3>
<br>
	string.cat(x, y) will not change x or y.  to set x to the result, use "x=string.cat(x, y)"<br>
	actually, all string functions should work like this (by not modifying the original arguments.<br>
<br>
<p>
</DIV><DIV ID=c6p_string_cmp     STYLE='display: block'><hr><h3><a name="nesla_string_cmp"><code>(number) string.cmp(string str1, string str2);</code></a></h3>
<p>
Case sensitive string comparison.
</p>
</DIV><DIV ID=c6p_string_icmp    STYLE='display: block'><hr><h3><a name="nesla_string_icmp"><code>(number) string.icmp(string str1, string str2);</code></a></h3>
<p>
Case insensitive string comparison.
</p>
</DIV><DIV ID=c6p_string_istr    STYLE='display: block'><hr><h3><a name="nesla_string_istr"><code>(string) string.istr(string stack, string needle);</code></a></h3>
<p>
Case insensitive substring search.
</p>
</DIV><DIV ID=c6p_string_join    STYLE='display: block'><hr><h3><a name="nesla_string_join"><code>(table) string.join(table str, string sep);</code></a></h3>
<p>
This will merge the table str into a single string separated by sep.
</p>
</DIV><DIV ID=c6p_string_len     STYLE='display: block'><hr><h3><a name="nesla_string_len"><code>(number) string.len(string str);</code></a></h3>
<p>
Length of the string (binary safe).
</p>
</DIV><DIV ID=c6p_string_ncmp    STYLE='display: block'><hr><h3><a name="nesla_string_ncmp"><code>(number) string.ncmp(string str1, string str2, number len);</code></a></h3>
<p>
Case sensitive substring comparison up to <I>len</I> characters.
</p>
</DIV><DIV ID=c6p_string_nicmp   STYLE='display: block'><hr><h3><a name="nesla_string_nicmp"><code>(number) string.nicmp(string str1, string str2, number len);</code></a></h3>
<p>
Case insensitive substring comparison up to <I>len</I> characters.
</p>
</DIV><DIV ID=c6p_string_split   STYLE='display: block'><hr><h3><a name="nesla_string_split"><code>(table) string.split(string str, string sep);</code></a></h3>
<p>
This will separate the string into substrings and put those substrings in the returned table.
</p>
</DIV><DIV ID=c6p_string_str     STYLE='display: block'><hr><h3><a name="nesla_string_str"><code>(string) string.str(string stack, string needle);</code></a></h3>
<p>
Case sensitive substring search.
</p>
</DIV><DIV ID=c6p_string_sub     STYLE='display: block'><hr><h3><a name="nesla_string_sub"><code>(string) string.sub(string stack, number offset[, number maxlen]);</code></a></h3>
<p>
Returns a substring ranging from <I>offset</I> to <I>maxlen</I>.
</p>

</DIV><DIV ID=c6p_string_tolower STYLE='display: block'><!-- CONTENTS_START -->
<A NAME="nesla_string_tolower"></A>
<H2>string.tolower<BR><HR></H2>

<H4>Description</H4>
<BLOCKQUOTE><P>
<P>Returns a lower case version of the supplied string.
</BLOCKQUOTE>
<!-- CONTENTS_END -->
</DIV><DIV ID=c6p_string_toupper STYLE='display: block'><!-- CONTENTS_START -->
<A NAME="nesla_string_toupper"></A>
<H2>string.toupper<BR><HR></H2>

<H4>Description</H4>
<BLOCKQUOTE><P>
<P>Returns an upper case version of the supplied string.
</BLOCKQUOTE>
<!-- CONTENTS_END -->
</DIV><DIV ID=c7p0 STYLE='display: block'><h1>7 - time.*()</h1>

</DIV><DIV ID=c7p_time_gmtime    STYLE='display: block'><!-- CONTENTS_START -->
<A NAME="nesla_gmtime"></A>
<H2>time.gmtime<BR><HR></H2>

<H4>Description</H4>
<BLOCKQUOTE><P>
<P>Returns a table representation of <VAR>timestamp</VAR>. If <VAR>timestamp</VAR>
is not defined, the function will use the current local system date.
</BLOCKQUOTE>
<!-- CONTENTS_END -->
</DIV><DIV ID=c7p_time_localtime STYLE='display: block'><!-- CONTENTS_START -->
<A NAME="nesla_localtime"></A>
<H2>time.localtime<BR><HR></H2>

<H4>Description</H4>
<BLOCKQUOTE><P>
<P>Returns a table representation of <VAR>timestamp</VAR>. If <VAR>timestamp</VAR>
is not defined, the function will use the current local system date.
</BLOCKQUOTE>
<!-- CONTENTS_END -->
</DIV><DIV ID=c7p_time_now       STYLE='display: block'><!-- CONTENTS_START -->
<a name="nesla_time"></a>
<H2>time.now<BR><HR></H2>

<H4>Description</H4>
<BLOCKQUOTE><P>
<P>Returns the elapsed time in seconds since January 1, 1970.
</BLOCKQUOTE>

<H4>Syntax</H4>
<BLOCKQUOTE><P><I>number</I> <B>=</B> <B>time(</B><B>)<BR></B></BLOCKQUOTE><P>

<H4>Return Value</H4>
<BLOCKQUOTE><P>
<P>Returns the time in seconds since the creation of the UNIXverse.
</BLOCKQUOTE><P>
<!-- CONTENTS_END -->



<A NAME="nesla_date"></A>
<H1>date</H1>
date -- Print a date in SQL format
<H2>Description</H2>
string <B>date</B> ( [number timestamp] )<BR>
<P>Returns a string representation of timestamp in the format 'YYYY-MM-DD'.  If
<VAR>timestamp</VAR> is not defined, the function will use the current system date.</P>
<H2>Parameters</H2>
<P>
<DL>
<DT><VAR>timestamp</VAR></DT>
<DD><P>The <B>number</B> of seconds since January 1, 1970 (commonly called a UNIX timestamp).</P></DD>
</DL>
</P>
<H2>Return Values</H2>
<P>Returns a formatted date <VAR>string</VAR> in the format 'YYYY-MM-DD'.</P>
<H2>Examples</H2>
<P>
<TABLE  WIDTH="100%" BORDER="0" CELLPADDING="0" CELLSPACING="0" CLASS="EXAMPLE" >
<TR><TD><P><B>Example 1. A <B>strlen()</B> example</B></P>
<TABLE BORDER="0" BGCOLOR="#E0E0E0" CELLPADDING="5" ><TR><TD><code ><span  style="color: #000000"><span  style="color: #0000BB">&lt;?php<br
	/>$str&nbsp;</span><span  style="color: #007700">=&nbsp;</span><span  style="color: #DD0000">'abcdef'</span><span  style="color: #007700">;<br
	/>echo&nbsp;</span><span  style="color: #0000BB">strlen</span><span  style="color: #007700">(</span><span  style="color: #0000BB">$str</span
	><span  style="color: #007700">);&nbsp;</span><span  style="color: #FF8000">//&nbsp;6<br  /><br  /></span><span  style="color: #0000BB">$str&nbsp;</span
	><span  style="color: #007700">=&nbsp;</span><span  style="color: #DD0000">'&nbsp;ab&nbsp;cd&nbsp;'</span><span  style="color: #007700">;<br
	/>echo&nbsp;</span><span  style="color: #0000BB">strlen</span><span  style="color: #007700">(</span><span  style="color: #0000BB">$str</span
	><span  style="color: #007700">);&nbsp;</span><span  style="color: #FF8000">//&nbsp;7<br  /></span><span style="color: #0000BB">?&gt;</span
	></span></code>
</TD></TR></TABLE>
</TD></TR></TABLE>
<BR>
<TABLE  BORDER="0" BGCOLOR="#E0E0E0" CELLPADDING="5"><TR><TD><PRE  CLASS="screen" >Array
(
    [0] =&gt; f'oo
    [1] =&gt; b'ar
    [2] =&gt; Array
        (
            [0] =&gt; fo'o
            [1] =&gt; b'ar
        )
)</PRE></TD></TR></TABLE>
</P>
<H2>See Also</H2>
<P>
<TABLE  BORDER="0">
<TR><TD><A HREF="function.count.html" ><B CLASS="function" >count()</B></A></TD></TR>
<TR><TD><A HREF="function.mb-strlen.html" ><B CLASS="function" >mb_strlen()</B></A></TD></TR>
</TABLE>
</DIV><DIV ID=c7p_time_sqldate   STYLE='display: block'><!-- CONTENTS_START -->
<A NAME="nesla_sqldate"></A>
<H2>time.sqldate<BR><HR></H2>

<H4>Description</H4>
<BLOCKQUOTE><P>
<P>Returns a string representation of <VAR>timestamp</VAR> in the format 'YYYY-MM-DD'.
If <VAR>timestamp</VAR> is not defined, the function will use the current local
system date.
</BLOCKQUOTE>

<H4>Syntax</H4>
<BLOCKQUOTE><P><I>string</I> <B>=</B> <B>sqldate(</B><I>[number timestamp]</I><B>)<BR></B></BLOCKQUOTE><P>
<BLOCKQUOTE>
<TABLE BGCOLOR="#E0E0E0" WIDTH=87% CELLPADDING=5 CELLSPACING=0>
<TR><TD><B>Parameter</B></TD><TD><B>Description</B></TD></TR>
<TR><TD><I>timestamp</I> </TD><TD>The <B>number</B> of seconds since January 1, 1970 UTC (commonly called a UNIX timestamp).</TD></TR>
</TABLE></BLOCKQUOTE>

<H4>Return Value</H4>
<BLOCKQUOTE><P>
<P>Returns a formatted date <VAR>string</VAR> in the format 'YYYY-MM-DD'.
</BLOCKQUOTE><P>

<H4>Remarks</H4>
<BLOCKQUOTE><P>
<P>No remarks.
</BLOCKQUOTE><P>

<H4>Examples</H4>
<BLOCKQUOTE><P>
<TABLE BORDER="0" BGCOLOR="#E0E0E0" CELLPADDING="5"><TR><TD>
<CODE>
	<B>print</B>(<B>sqldate</B>());
</CODE></TD></TR></TABLE>
<P>The above example will output something similar to: "<B>2007-07-01</B>"</P>
<P>
<TABLE BORDER="0" BGCOLOR="#E0E0E0" CELLPADDING="5"><TR><TD>
<CODE>
	<B>print</B>(<B>sqldate</B>(0)+" "+<B>sqltime</B>(0));
</CODE></TD></TR></TABLE>
<P>The above example will output something similar to (note the adjustment for local time): "<B>1969-12-31 19:00:00</B>"</P>
</BLOCKQUOTE><P>

<H4>See Also</H4>
<BLOCKQUOTE><P>
<B><A HREF="#c7p_time_sqltime"          onClick="showpage('7', '_time_sqltime');         return false;">time.sqltime()</A></B>
</BLOCKQUOTE><P>
<!-- CONTENTS_END -->
</DIV><DIV ID=c7p_time_sqltime   STYLE='display: block'><!-- CONTENTS_START -->
<A NAME="nesla_sqltime"></A>
<H2>time.sqltime<BR><HR></H2>

<H4>Description</H4>
<BLOCKQUOTE><P>
<P>Returns a string representation of <VAR>timestamp</VAR> in the format 'HH:MM:SS'.
If <VAR>timestamp</VAR> is not defined, the function will use the current local
system time.
</BLOCKQUOTE>

<H4>Syntax</H4>
<BLOCKQUOTE><P><I>string</I> <B>=</B> <B>sqltime(</B><I>[number timestamp]</I><B>)<BR></B></BLOCKQUOTE><P>
<BLOCKQUOTE>
<TABLE BGCOLOR="#E0E0E0" WIDTH=87% CELLPADDING=5 CELLSPACING=0>
<TR><TD><B>Parameter</B></TD><TD><B>Description</B></TD></TR>
<TR><TD><I>timestamp</I> </TD><TD>The <B>number</B> of seconds since January 1, 1970 UTC (commonly called a UNIX timestamp).</TD></TR>
</TABLE></BLOCKQUOTE>

<H4>Return Value</H4>
<BLOCKQUOTE><P>
<P>Returns a formatted time <VAR>string</VAR> in the format 'HH:MM:SS'.
</BLOCKQUOTE><P>

<H4>Remarks</H4>
<BLOCKQUOTE><P>
<P>No remarks.
</BLOCKQUOTE><P>

<H4>Examples</H4>
<BLOCKQUOTE><P>
<TABLE BORDER="0" BGCOLOR="#E0E0E0" CELLPADDING="5"><TR><TD>
<CODE>
	<B>print</B>(<B>sqltime</B>());
</CODE></TD></TR></TABLE>
<P>The above example will output something similar to: "<B>16:30:45</B>"</P>
<P>
<TABLE BORDER="0" BGCOLOR="#E0E0E0" CELLPADDING="5"><TR><TD>
<CODE>
	<B>print</B>(<B>sqldate</B>(0)+" "+<B>sqltime</B>(0));
</CODE></TD></TR></TABLE>
<P>The above example will output something similar to (note the adjustment for local time): "<B>1969-12-31 19:00:00</B>"</P>
</BLOCKQUOTE><P>

<H4>See Also</H4>
<BLOCKQUOTE><P>
<B><A HREF="#c7p_time_sqldate"          onClick="showpage('7', '_time_sqldate');         return false;">time.sqldate()</A></B>
</BLOCKQUOTE><P>
<!-- CONTENTS_END -->
</DIV><DIV ID=c8p0 STYLE='display: block'><h1>8 - The Extension Libraries</h1>

<h2>neslaext functions</h2>
</DIV><DIV ID=c8p_libext_base64_decode STYLE='display: block'><hr><h3><a name="nesla_base64_decode"><code>(string) base64.decode(string encoded);</code></a></h3>
<p>
Return a decoded value from a base64-encoded string.
</p>
</DIV><DIV ID=c8p_libext_base64_encode STYLE='display: block'><hr><h3><a name="nesla_base64_encode"><code>(string) base64.encode(string decoded);</code></a></h3>
<p>
Return an encoded value from a raw string.
</p>
</DIV><DIV ID=c8p_libext_dirlist       STYLE='display: block'><hr><h3><a name="nesla_dirlist"><code>(table) dirlist(string dirname);</code></a></h3>
<p>
Returns a table containing files and attributes in the supplied dirname.
</p>
</DIV><DIV ID=c8p_libext_rot13         STYLE='display: block'><hr><h3><a name="nesla_rot13"><code>(string) rot13(string str);</code></a></h3>
<p>
Returns a rot13 *cough* encoded string from str.
</p>
<p>
Double-rot13 encryption is so stealthy, you won't even know it's been encrypted.
</p>
</DIV><DIV ID=c8p_libext_sort_bykey    STYLE='display: block'><hr><h3><a name="nesla_sort_bykey"><code>(number) sort.bykey(table t, string subkey);</code></a></h3>
<p>
</p>
</DIV><DIV ID=c8p_libext_sort_byname   STYLE='display: block'><hr><h3><a name="nesla_sort_byname"><code>(number) sort.byname(table t[, number recursive]);</code></a></h3>
<p>
</p>
</DIV><DIV ID=c8p_libext_xml_read      STYLE='display: block'><hr><h3><a name="nesla_xml_read"><code>(table) xml.read(string str);</code></a></h3>
<p>
Read the supplied XML text and return a digested table.
This is _not_ a pretty function.
</p>

</DIV><DIV ID=c9p0 STYLE='display: block'><h1>9 - tcp.*()</h1>
</DIV><DIV ID=c9p_libtcp_http_get      STYLE='display: block'><hr><h3><a name="nesla_http_get"><code>(table) http.get(number ssl, string host, number port, string uri);</code></a></h3>
<p>
Connect to an HTTP server and retrieve the requested uri. Returns a table with { head, body } elements.
</p>
<hr>
</DIV><DIV ID=c9p_libtcp_tcp_accept    STYLE='display: block'><hr><h3><a name="nesla_tcp_accept"><code>(sock4) tcp.accept(sock4 bindsock);</code></a></h3>
<p>
</DIV><DIV ID=c9p_libtcp_tcp_bind      STYLE='display: block'><hr><h3><a name="nesla_tcp_bind"><code>(sock4) tcp.bind(string host, number port, number ssl);</code></a></h3>
<p>
</DIV><DIV ID=c9p_libtcp_tcp_close     STYLE='display: block'><hr><h3><a name="nesla_tcp_close"><code>(number) tcp.close(sock4 socket);</code></a></h3>
<p>
</DIV><DIV ID=c9p_libtcp_tcp_gets      STYLE='display: block'><hr><h3><a name="nesla_tcp_gets"><code>(string) tcp.gets(sock4 socket);</code></a></h3>
<p>
</DIV><DIV ID=c9p_libtcp_tcp_open      STYLE='display: block'><hr><h3><a name="nesla_tcp_open"><code>(sock4) tcp.open(string host, number port, number ssl);</code></a></h3>
<p>
</DIV><DIV ID=c9p_libtcp_tcp_read      STYLE='display: block'><hr><h3><a name="nesla_tcp_read"><code>(string) tcp.read(sock4 socket);</code></a></h3>
<p>
</DIV><DIV ID=c9p_libtcp_tcp_write     STYLE='display: block'><hr><h3><a name="nesla_tcp_write"><code>(number) tcp.write(sock4 socket, string str);</code></a></h3>
<p>
</DIV><DIV ID=c10p0 STYLE='display: block'>
<h1>10 - The C API</h1>
<p>
I'm lazy, so here's the long ugly version.  This is everything your C program
will ever need to know about Nesla.  Actually, it needs to know a lot less, but
hey.
</p>
<PRE>/*
    NESLA NullLogic Embedded Scripting Language - Copyright (C) 2007 Dan Cahill

    This program is free software; you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation; either version 2 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program; if not, write to the Free Software
    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
*/
#ifndef _NESLA_H
#define _NESLA_H 1

#if defined(TINYCC)||defined(__TURBOC__)
struct timeval { long tv_sec; long tv_usec; };
#endif
#if defined(_MSC_VER)
#define WIN32_LEAN_AND_MEAN
/* always include winsock2 before windows */
#include &lt;winsock2.h>
#include &lt;windows.h>
#include &lt;time.h>
#elif !defined(__TURBOC__)
#include &lt;sys/time.h>
#endif
#include &lt;setjmp.h>

#define NESLA_NAME      "nesla"
#define NESLA_VERSION   "0.9.1"

#define MAX_OBJNAMELEN  64
#define MAX_OUTBUFLEN   8192
#define OUTBUFLOWAT	4096

/* nesla object types */
#define NT_NULL         0
#define NT_BOOLEAN      1
#define NT_NUMBER       2
#define NT_STRING       3
#define NT_NFUNC        4
#define NT_CFUNC        5
#define NT_TABLE        6
#define NT_CDATA        7

/* nesla object status flags */
#define NST_HIDDEN	0x01
#define NST_READONLY	0x02
#define NST_SYSTEM	0x04
#define NST_AUTOSORT	0x08
#define NST_LINK	0x10

#define num_t double
#define uchar unsigned char
#define obj_t struct nes_objrec
#define val_t struct nes_valrec
#define nes_t struct nes_state

/* should be typedef int(*NES_CFUNC)(nes_state *); */
typedef int(*NES_CFUNC)(void *);
#define NES_FUNCTION(name) int name(nes_state *N)

/*
 * define a callback function type so CDATA objects
 * can choose the terms of their own death.
 */
/* should be typedef void(*NES_CFREE)(nes_state *, obj_t *); */
typedef void(*NES_CFREE)(void *, void *);

typedef struct NES_CDATA {
	/* standard header info for CDATA object */
	char      obj_type[16]; /* tell us all about yourself in 15 characters or less */
	NES_CFREE obj_term;     /* now tell us how to kill you */
	/* now begin the stuff that's type-specific */
} NES_CDATA;
typedef struct nes_valrec {
	unsigned short type; /* val type */
	unsigned short attr; /* status flags (hidden, readonly, system, autosort, etc...) */
	unsigned short refs; /* number of references to this node */
	unsigned long  size; /* storage size of string, nfunc or cdata */
	union {
		num_t  num;
		char  *str;
		NES_CFUNC cfunc;
		NES_CDATA *cdata;
		obj_t *table;
	} d;
} nes_valrec;
typedef struct nes_objrec {
	obj_t *prev;
	obj_t *next;
	val_t *val;
	char name[MAX_OBJNAMELEN+1];
} nes_objrec;
typedef struct nes_state {
	uchar *blockptr;
	uchar *blockend;
	uchar *readptr;
	obj_t g;
	obj_t l;
	obj_t r;
	short brk;
	short cnt;
	short ret;
	short err;
	short debug;
	short single;
	short strict;
	short warnings;
	jmp_buf *savjmp;
	struct timeval ttime;
	unsigned short outbuflen;
	char numbuf[128];
	char outbuf[MAX_OUTBUFLEN+1];
	char errbuf[256];
} nes_state;

#ifndef NESLA_NOFUNCTIONS
/* exec */
nes_state *nes_newstate   (void);
nes_state *nes_endstate   (nes_state *N);
obj_t     *nes_exec       (nes_state *N, const char *string);
int        nes_execfile   (nes_state *N, char *file);
/* objects */
void       nes_setvaltype (nes_state *N, obj_t *cobj, unsigned short type);
void       nes_linkval    (nes_state *N, obj_t *cobj1, obj_t *cobj2);
void       nes_unlinkval  (nes_state *N, obj_t *cobj);
void       nes_freetable  (nes_state *N, obj_t *tobj);
obj_t     *nes_getobj     (nes_state *N, obj_t *tobj, char *oname);
obj_t     *nes_getiobj    (nes_state *N, obj_t *tobj, unsigned long oindex);
obj_t     *nes_setobj     (nes_state *N, obj_t *tobj, char *oname, unsigned short otype, NES_CFUNC _fptr, num_t _num, char *_str, long _slen);
void       nes_strcat     (nes_state *N, obj_t *cobj, char *str, long len);
void       nes_strmul     (nes_state *N, obj_t *cobj, unsigned long n);
short      nes_tobool     (nes_state *N, obj_t *cobj);
num_t      nes_tonum      (nes_state *N, obj_t *cobj);
char      *nes_tostr      (nes_state *N, obj_t *cobj);
/* parser */
obj_t     *nes_eval       (nes_state *N, const char *string);
obj_t     *nes_evalf      (nes_state *N, const char *fmt, ...);
#endif

#define    nes_isnull(o)            (o==NULL||o->val==NULL||o->val->type==NT_NULL)
#define    nes_isbool(o)            (o!=NULL&&o->val!=NULL&&o->val->type==NT_BOOLEAN)
#define    nes_isnum(o)             (o!=NULL&&o->val!=NULL&&o->val->type==NT_NUMBER)
#define    nes_isstr(o)             (o!=NULL&&o->val!=NULL&&o->val->type==NT_STRING)
#define    nes_istable(o)           (o!=NULL&&o->val!=NULL&&o->val->type==NT_TABLE)

#define    nes_istrue(o)            nes_tobool(N, o)?1:0

#define    nes_typeof(o)            nes_isnull(o)?NT_NULL:o->val->type

#define    nes_getnum(N,o,n)        nes_tonum(N, nes_getobj(N,o,n))
#define    nes_getstr(N,o,n)        nes_tostr(N, nes_getobj(N,o,n))

#define    nes_setnum(N,t,n,v)      nes_setobj(N, t, n, NT_NUMBER, (NES_CFUNC)NULL, v, NULL, 0)
#define    nes_setstr(N,t,n,s,l)    nes_setobj(N, t, n, NT_STRING, (NES_CFUNC)NULL, 0, s,    l)
#define    nes_settable(N,t,n)      nes_setobj(N, t, n, NT_TABLE,  (NES_CFUNC)NULL, 0, NULL, 0)
#define    nes_setcfunc(N,t,n,p)    nes_setobj(N, t, n, NT_CFUNC,  (NES_CFUNC)p,    0, NULL, 0)
#define    nes_setnfunc(N,t,n,s,l)  nes_setobj(N, t, n, NT_NFUNC,  (NES_CFUNC)NULL, 0, s,    l)
#define    nes_setcdata(N,t,n,s,l)  nes_setobj(N, t, n, NT_CDATA,  (NES_CFUNC)NULL, 0, (void *)s, l)

#define    nes_setinum(N,t,n,v)     nes_setiobj(N, t, n, NT_NUMBER, (NES_CFUNC)NULL, v, NULL, 0)
#define    nes_setistr(N,t,n,s,l)   nes_setiobj(N, t, n, NT_STRING, (NES_CFUNC)NULL, 0, s,    l)
#define    nes_setitable(N,t,n)     nes_setiobj(N, t, n, NT_TABLE,  (NES_CFUNC)NULL, 0, NULL, 0)
#define    nes_seticfunc(N,t,n,p)   nes_setiobj(N, t, n, NT_CFUNC,  (NES_CFUNC)p,    0, NULL, 0)
#define    nes_setinfunc(N,t,n,s,l) nes_setiobj(N, t, n, NT_NFUNC,  (NES_CFUNC)NULL, 0, s,    l)
#define    nes_seticdata(N,t,n,s,l) nes_setiobj(N, t, n, NT_CDATA,  (NES_CFUNC)NULL, 0, (void *)s, l)

#endif /* nesla.h */
</PRE>
</DIV>
	</TD>
	<TD HEIGHT="100%" WIDTH="10" ALIGN=CENTER>&nbsp;</TD>
</TR>
<TR>
	<TD WIDTH="200" BGCOLOR="#003399" ALIGN=RIGHT VALIGN=BOTTOM><IMG SRC="/images/blue-rounder1.gif" WIDTH="14" HEIGHT="20" BORDER="0" ALT=""></TD>
	<TD width="100%">
		<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 WIDTH="100%">
		<TR>
		<TD>&nbsp;</TD>
		<TD ALIGN=left VALIGN=BOTTOM WIDTH="50%">
		<FONT FACE=Arial COLOR="#000000" SIZE=-2>
		Please direct feedback to:<BR>
		<A HREF="mailto:nulllogic%40users.sourceforge.net">nulllogic@users.sourceforge.net</A>
		</FONT>
		</TD><TD ALIGN="right" VALIGN="BOTTOM" WIDTH="50%">
		<FONT FACE=Arial COLOR="#000000" SIZE=-2>
		Copyright &copy; 2007 NullLogic<BR>
		All rights reserved
		</FONT>
		</TD></TR>
		</TABLE>
	</TD>
	<TD WIDTH="10" ALIGN=CENTER>&nbsp;</TD>
</TR>
</TABLE>
<SCRIPT LANGUAGE=JavaScript TYPE="text/javascript">
<!--
showpage(1, 0);
// -->
</SCRIPT>
</BODY>
</HTML>
